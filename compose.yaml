# AI Voice Assistant - Docker Compose Configuration
# 使用 Compose Specification (最新版本)
#
# 使用方式:
#   docker compose up -d
#
# 映像由 GitHub Actions 自動建置並推送至 ghcr.io

name: voice-assistant

services:
  app:
    image: ghcr.io/weihanchen/ai-voice-assistant-fastrtc:latest
    ports:
      - "${SERVER_PORT:-7860}:7860"
    env_file:
      - .env
    environment:
      - GRADIO_SERVER_NAME=0.0.0.0
      - PYTHONUNBUFFERED=1
    volumes:
      # 模型持久化（避免每次重啟重新下載）
      - models:/app/models
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 4G
        reservations:
          memory: 2G
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:7860')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  models:
    driver: local
