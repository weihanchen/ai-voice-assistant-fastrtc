# Feature Specification: Exchange Rate Query Tool

**Feature Branch**: `003-exchange-rate-query`
**Created**: 2025-12-26
**Status**: Draft
**Input**: User description: "匯率查詢工具 - 使用者故事與換算情境、支援貨幣種類與代碼標準化、ExchangeRate-API 整合需求、換算邏輯與成功指標"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 查詢貨幣匯率 (Priority: P1)

使用者透過語音詢問特定貨幣對新台幣的匯率，系統查詢匯率 API 並以語音回報目前的匯率。

**Why this priority**: 這是匯率查詢的核心功能，使用者最常見的需求是「現在美金換台幣多少」。

**Independent Test**: 對著麥克風說「美金換台幣多少」，系統在 5 秒內語音回應「目前 1 美元可兌換約 32.5 新台幣」。

**Acceptance Scenarios**:

1. **Given** 系統處於待命狀態, **When** 使用者說「美金匯率多少」, **Then** 系統語音回應 1 美元對新台幣的匯率
2. **Given** 系統處於待命狀態, **When** 使用者說「日幣換台幣」, **Then** 系統語音回應 1 日元對新台幣的匯率
3. **Given** 系統處於待命狀態, **When** 使用者說「歐元匯率」, **Then** 系統語音回應 1 歐元對新台幣的匯率

---

### User Story 2 - 貨幣金額換算 (Priority: P2)

使用者可指定金額進行貨幣換算，系統計算並回報換算結果。

**Why this priority**: 金額換算是匯率查詢的實用延伸，讓使用者可以直接得到換算結果，而非自己計算。

**Independent Test**: 對著麥克風說「100 美金換台幣多少」，系統回應「100 美元約可兌換 3,250 新台幣」。

**Acceptance Scenarios**:

1. **Given** 系統處於待命狀態, **When** 使用者說「100 美金換台幣」, **Then** 系統語音回應換算後的新台幣金額
2. **Given** 系統處於待命狀態, **When** 使用者說「5000 日幣是多少台幣」, **Then** 系統語音回應換算後的新台幣金額
3. **Given** 系統處於待命狀態, **When** 使用者說「1000 台幣換美金」, **Then** 系統語音回應換算後的美元金額

---

### User Story 3 - 處理不支援的貨幣 (Priority: P3)

當使用者詢問不支援的貨幣時，系統友善地告知並提示可支援的貨幣種類。

**Why this priority**: 錯誤處理確保良好的使用者體驗，避免使用者困惑。

**Independent Test**: 對著麥克風說「比特幣換台幣」，系統回應「抱歉，目前僅支援主要國際貨幣，例如美金、日幣、歐元、人民幣等」。

**Acceptance Scenarios**:

1. **Given** 系統處於待命狀態, **When** 使用者詢問不支援的貨幣（如「比特幣匯率」）, **Then** 系統友善告知目前不支援該貨幣
2. **Given** 系統處於待命狀態, **When** 使用者說出無法辨識的貨幣名稱, **Then** 系統回應無法識別並提供支援的貨幣範例

---

### Edge Cases

- 當匯率 API 無回應或逾時時，系統回應「抱歉，目前無法取得匯率資訊，請稍後再試」
- 當使用者只說「匯率」而未指定貨幣時，系統詢問「請問您想查詢哪種貨幣的匯率？」
- 當使用者使用非標準貨幣名稱（如「美金」vs「美元」、「日幣」vs「日圓」）時，系統能正確識別
- 當換算金額過大或過小（如 0 或負數）時，系統回應「請提供有效的金額」
- 當使用者詢問相同貨幣換算（如「台幣換台幣」）時，系統回應「您查詢的是相同貨幣，無需換算」

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系統 MUST 支援辨識常用貨幣名稱與別名（美金/美元/USD、日幣/日圓/JPY、歐元/EUR、人民幣/CNY、韓元/KRW、港幣/HKD、英鎊/GBP、澳幣/AUD）
- **FR-002**: 系統 MUST 以新台幣（TWD）作為預設基準貨幣進行匯率查詢與換算
- **FR-003**: 系統 MUST 透過外部匯率 API 查詢即時匯率資料
- **FR-004**: 系統 MUST 以口語化繁體中文回應匯率資訊
- **FR-005**: 系統 MUST 支援指定金額的雙向貨幣換算（外幣→台幣、台幣→外幣）
- **FR-006**: 系統 MUST 在 API 查詢失敗時提供友善的錯誤訊息
- **FR-007**: 系統 MUST 將匯率查詢實作為 Tool，供 LLM 自動調用
- **FR-008**: 系統 MUST 對貨幣名稱進行標準化處理（如「美金」→「USD」）

### Key Entities

- **Currency**: 貨幣資訊，包含貨幣代碼（ISO 4217）、中文名稱、常見別名
- **ExchangeRate**: 匯率資料，包含來源貨幣、目標貨幣、匯率值、查詢時間
- **ConversionResult**: 換算結果，包含原始金額、換算後金額、使用的匯率

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 從使用者說出貨幣名稱到系統開始語音回應，延遲不超過 5 秒
- **SC-002**: 系統正確辨識支援貨幣名稱與別名的成功率達 95% 以上
- **SC-003**: API 查詢失敗時，100% 提供友善錯誤訊息而非靜默或技術性錯誤
- **SC-004**: 匯率換算結果準確度達 100%（基於 API 回傳的匯率資料）
- **SC-005**: 支援至少 8 種常用國際貨幣的查詢與換算

## Assumptions

- 使用者會以繁體中文詢問匯率
- 網路連線穩定，匯率 API 可正常存取
- 使用者詢問的是「即時」匯率，不包含歷史匯率或匯率趨勢
- 匯率資料可接受一定程度的延遲（如快取 5-10 分鐘）
- 所有換算預設以新台幣為基準貨幣

## Dependencies

- 001-fastrtc-voice-pipeline（語音輸入輸出管線）
- 002-weather-query（參考 Tool 實作模式）
- LLMClient（對話處理與 Tool 調用）
- 外部匯率 API（匯率資料來源）

## Out of Scope

- 歷史匯率查詢
- 匯率趨勢分析或預測
- 加密貨幣匯率
- 銀行買賣價差查詢
- 多幣種連續換算（如 USD→JPY→TWD）
