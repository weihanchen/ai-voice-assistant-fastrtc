# Feature Specification: 角色切換面試官功能

**Feature Branch**: `008-role-switching`  
**Created**: 2025-01-25  
**Status**: Draft  
**Input**: User description: "008-role-switching-interviewer - **目標**：實現動態角色切換功能，以面試官為 MVP 展示 Prompt Engineering 應用 - **核心功能**： Role 基礎架構與註冊機制 面試官角色配置（正式語氣、深度追問） 意圖識別支援角色切換指令 Gradio UI 角色選擇器與即時狀態顯示 - **場景展示**： 使用者對麥克風練習自我介紹 AI 針對回答內容進行深度追問（具體細節、問題解決過程） 語音指令「切換到面試官」自動切換模式 - **設計原則**： 最小侵入性：重用現有 LLMClient.system_prompt 參數 擴展性：為未來新角色保留接口（不實作自定義角色） 語言一致性：以繁體中文為主，無需多語言支援 無持久化需求：單次對話內的角色切換即可"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 基礎角色切換機制 (Priority: P1)

使用者能夠在語音對話過程中透過系統提示或語音指令切換 AI 的角色，從而改變對話風格和互動模式。

**Why this priority**: 這是整個功能的核心基礎，提供角色切換的根本能力，是所有其他場景的前提條件。

**Independent Test**: 可以透過程式化方式測試角色註冊和切換邏輯，無需依賴 UI 或語音功能。

**Acceptance Scenarios**:

1. **Given** 系統已啟動，**When** 註冊新角色，**Then** 該角色可用於切換
2. **Given** 多個角色已註冊，**When** 切換到指定角色，**Then** LLM 系統提示詞更新為對應角色設定
3. **Given** UI glue 已連結，**When** 使用 Sidebar 選單切換，**Then** pipeline 狀態 & system_prompt 應與選定角色保持同步（已由 test_voice_pipeline.py 驗證）

---

### User Story 2 - 面試官角色實作 (Priority: P1)

面試官角色能夠以正式、專業的語氣進行深度提問，針對使用者的回答進行追問，模擬真實面試場景。

**Why this priority**: 這是 MVP 的核心展示功能，直接體現 Prompt Engineering 的價值，為使用者提供實際應用場景。

**Independent Test**: 可以透過文字輸入測試面試官角色的回應品質和追問邏輯，驗證角色配置正確性。

**Acceptance Scenarios**:

1. **Given** 角色已切換為面試官，**When** 使用者進行自我介紹，**Then** 系統回應符合面試官語氣風格
2. **Given** 使用者回答問題，**When** 回答內容不夠詳細，**Then** 系統能針對具體細節進行追問
3. **Given** 使用者描述問題解決過程，**When** 過程描述模糊，**Then** 系統能要求補充解決步驟和思考邏輯

---

### User Story 3 - 語音指令角色切換 (Priority: P2)

使用者能夠透過語音指令（如「切換到面試官」）直接切換 AI 角色，提供更自然的互動體驗。

**Why this priority**: 這是語音助理的核心功能，讓使用者能夠用自然語言控制角色切換，提升使用體驗。

**Independent Test**: 可以透過模擬語音輸入或直接文字指令測試意圖識別和角色切換邏輯。

**Acceptance Scenarios**:

1. **Given** 系統正在進行語音對話，**When** 使用者說「切換到面試官」，**Then** 系統識別意圖並切換角色
2. **Given** 使用者發出模糊的切換指令，**When** 指令不符合預設格式，**Then** 系統提示正確的指令格式
3. **Given** 角色切換成功，**When** 系統回應，**Then** 使用繁體中文確認角色已切換

---

### User Story 4 - Gradio UI 角色選擇器 (Priority: P2)

使用者能夠透過圖形界面查看當前角色狀態並手動選擇角色，提供視覺化的角色管理介面。

**Why this priority**: 提供視覺化介面增強使用者體驗，讓使用者能清楚了解當前狀態並進行精確控制。

**Independent Test**: 可以透過 UI 自動化測試角色選擇器的互動邏輯和狀態顯示。

**Acceptance Scenarios**:

1. **Given** UI 已載入，**When** 使用者查看角色選擇器，**Then** 顯示當前活躍角色和可用角色列表
2. **Given** 使用者在選擇器中點擊角色，**When** 選擇新角色，**Then** 系統角色切換並更新 UI 狀態
3. **Given** 角色切換發生，**When** 狀態更新，**Then** UI 即時顯示新角色名稱和相關資訊

---

### Edge Cases

- 當使用者發出語音切換指令但語音識別失敗時，系統應提示重新發出指令
- 當嘗試切換到不存在的角色時，系統應顯示可用角色列表
- 當系統提示詞更新失敗時，角色切換應回滾到前一個狀態
- 當多個角色切換指令同時發出時，系統應以最新指令為準
- 當網路連線中斷時，角色切換功能應降級為本地模式

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系統必須提供角色註冊機制，支援動態添加新角色配置
- **FR-002**: 系統必須支援角色切換功能，能夠在對話中切換 AI 的系統提示詞
- **FR-003**: 系統必須實作面試官角色，包含正式語氣風格和深度追問能力
- **FR-004**: 系統必須支援意圖識別，能夠識別「切換到[角色名稱]」格式的語音指令
- **FR-005**: 系統必須提供 Gradio UI 介面，顯示當前角色狀態和角色選擇器
- **FR-006**: 系統必須重用現有 LLMClient.system_prompt 參數進行角色提示詞管理
- **FR-007**: 系統必須為未來角色擴展保留接口，支援新角色的輕鬆添加
- **FR-008**: 系統必須以繁體中文為主要語言，所有回應和提示均使用繁體中文
- **FR-009**: 系統必須在單次對話會話中維護角色狀態，無需持久化儲存
- **FR-010**: 系統必須處理角色切換失敗的異常情況，提供適當的錯誤回饋

### Key Entities

- **Role**: 代表 AI 對話角色的實體，包含角色名稱、系統提示詞、語氣風格等屬性
- **RoleRegistry**: 角色註冊管理器，負責角色的註冊、查詢和切換邏輯
- **IntentRecognizer**: 意圖識別器，負責解析語音指令中的角色切換意圖
- **RoleState**: 角色狀態管理器，維護當前活躍角色和狀態資訊

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 使用者能夠在 3 秒內成功切換 AI 角色（從發出指令到確認切換完成）
- **SC-002**: 面試官角色的追問回應達到 85% 的相關性評分（由人工評估）
- **SC-003**: 語音指令識別準確率達到 90% 以上（在安靜環境下測試）
- **SC-004**: 角色切換功能在 100 次連續操作中的成功率達到 95% 以上
- **SC-005**: 使用者對角色切換功能的滿意度評分達到 4.0/5.0 以上（用戶調查）
- **SC-006**: 系統支援至少 3 個預設角色（面試官、助理、教練）的無縫切換
- **SC-007**: 新角色的添加和配置時間不超過 10 分鐘（開發者效率指標）